<!DOCTYPE html>
<html lang="en">



<head>
    <meta name="description" content="Learn Game Maker fundamentals in this tutorial.">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6 Code for the Controller Fight Object</title>
    
   
 
 
    
    
    <link rel="shortcut icon" href="../../../../../Images/favicon.ico" type="image/x-icon">


    

<link href="../../../../../CSS/myStyles.css" rel="stylesheet" type="text/css">
<link href="../../../../../CSS/DarkOnLight.css" rel="stylesheet" type="text/css">


<style type="text/css">
  /* Add custom styles here if needed */
</style>


</head>


<body>

<div class="wrapper">
<header class="header">
    <meta name="description" content="Learn web design fundamentals in this tutorial.">Header</header>
  
  <ul class="navigation">
   <li><a href="../../../../../index.html" class="active"title="Home">Home</a></li>
  <li><a href="../../../../../Articles-This-Week.html" class="active"title="Articles This Week">&#9729;</a></li>
  <li><a href="../../../../../Articles-By-Year.html" title= "Articles By Year">Articles By Year</a></li>
  <li><a href="../../../../../About.html" title="About">About</a></li>
</ul>

<div class = "backgroundBlack"> <p class="h2Silver"><span class="h2Gold"><span class="h2Gold">~Articles This Week~</span></span></p></div>

<article class="main">
  
  
  
  <!--Main Article -->
  
  <p class="h2Black" >~6 Code for the Controller Fight Object~</p>
  
  
  <p class="author">By StarsInDust</p> 
  
   <p class="articleDate" style="text-align:right" >4/27/2026</p>
   
    <p class="H2LBrown"> JUST CODE</p>
   
<p>&nbsp;</p>
<p class="RecipeHeading">// ~~~~~~~~~~~~~    obj_fight_controller - CREATE EVENT   ~~~~~~~~~~~~</p>
<p class="code"><strong><span style="color:#00B050; ">// Controls the fight scene flow</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">// IMPORTANT: Destroy any dungeon  hero that might have spawned</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">// This prevents the small hero  from appearing in the fight</span></strong><span style="color:#00B050; "> <strong>room</strong></span></p>
<p class="code">if (instance_exists(object_hero)) {</p>
<p class="code">     instance_destroy(object_hero);</p>
<p class="code">    <strong><span style="color:#C00000; ">show_debug_message(&quot;Removed dungeon hero from fight  room&quot;);</span></strong></p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Initialize fight-related global variables if not already  set</span></strong></p>
<p class="code">if (!variable_global_exists(&quot;hero_max_hp&quot;)) {</p>
<p class="code">    global.hero_max_hp =  100;</p>
<p class="code">    global.hero_current_hp  = 100;</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">If hero HP hasn't been set yet, initialize it</span></strong></p>
<p class="code">if (global.hero_current_hp == undefined || global.hero_current_hp  &lt;= 0) {</p>
<p class="code">    global.hero_current_hp  = global.hero_max_hp;</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">// Fight state flags</span></strong></p>
<p class="code">fight_won = false;</p>
<p class="code">fight_lost = false;</p>
<p class="code">fight_in_progress = true;</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Transition settings</span></strong></p>
<p class="code">transition_timer = 0;</p>
<p class="code">transition_delay = 90; // 1.5 seconds at 60 FPS</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Create combatants</span></strong></p>
<p class="code">if (!instance_exists(obj_hero_fight)) {</p>
<p class="code">     instance_create_depth(room_width * 0.35, room_height * 0.5, -100,  obj_hero_fight);</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code">if (!instance_exists(obj_enemy_fight)) {</p>
<p class="code">     instance_create_depth(room_width * 0.60, room_height * 0.5, -100,  obj_enemy_fight);</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">// Store the room we came from  (for returning)</span></strong></p>
<p class="code">if (variable_global_exists(&quot;current_room&quot;)) {</p>
<p class="code">    global.previous_room =  global.current_room;</p>
<p class="code">} else {</p>
<p class="code">    global.previous_room =  room; <strong><span style="color:#00B050; ">// Use current room if global.current_room  not set</span></strong></p>
<p class="code">}</p>
<p class="code">global.in_fight = true;</p>
<p class="MsoNormal">&nbsp;</p>
<p class="RecipeHeading">// ~~~~~~~~~~~~~~~~~     obj_fight_controller - STEP EVENT   ~~~~~~~~~</p>
<p class="code"><strong><span style="color:#00B050; ">// Handle fight progression and  outcomes</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">// Check for fight end</span></strong><span style="color:#00B050; "> <strong>conditions</strong></span></p>
<p class="code">&nbsp;</p>
<p class="code">if (fight_won || fight_lost) {</p>
<p class="code">    fight_in_progress =  false;</p>
<p class="code">    transition_timer++;</p>
<p class="code">    </p>
<p class="code">    if (transition_timer  &gt;= transition_delay) {</p>
<p class="code">        <strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Fight won -  return to dungeon</span></strong></p>
<p class="code">        if (fight_won) {</p>
<p class="code">            <strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Award  experience, gold, etc.</span></strong></p>
<p class="code">            if (variable_global_exists(&quot;hero_experience&quot;))  {</p>
<p class="code">                 global.hero_experience += 50;</p>
<p class="code">            }</p>
<p class="code">            if  (variable_global_exists(&quot;hero_gold&quot;)) {</p>
<p class="code">                 global.hero_gold += irandom_range(10, 30);</p>
<p class="code">            }</p>
<p class="code">            </p>
<p class="code">            <strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Save hero HP</span></strong></p>
<p class="code">            if  (instance_exists(obj_hero_fight)) {</p>
<p class="code">                 global.hero_current_hp = obj_hero_fight.current_hp;</p>
<p class="code">            }</p>
<p class="code">            </p>
<p class="code"><strong><span style="color:#00B050; ">            // Return to previous room</span></strong></p>
<p class="code">            global.in_fight  = false;</p>
<p class="code">             room_goto(global.previous_room);</p>
<p class="code">        }</p>
<p class="code">        </p>
<p class="code">        <strong><span style="color:#00B050; ">// Fight lost - game over or return to town</span></strong></p>
<p class="code">        if (fight_lost) {</p>
<p class="code">            global.in_fight  = false;</p>
<p class="code">            <strong><span style="color:#00B050; ">// You can create a game over room or respawn logic</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">            // For now, let's respawn in town  with reduced HP</span></strong></p>
<p class="code">             global.hero_current_hp = global.hero_max_hp * 0.5;</p>
<p class="code">            </p>
<p class="code">            <strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Return to  town or a safe room</span></strong></p>
<p class="code">            if  (room_exists(rm_town)) {</p>
<p class="code">                 room_goto(rm_town);</p>
<p class="code">            } else {</p>
<p class="code">                 room_goto(global.previous_room);</p>
<p class="code">            }</p>
<p class="code">        }</p>
<p class="code">    }</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">ESC key to forfeit (optional)</span></strong></p>
<p class="code">if (keyboard_check_pressed(vk_escape) &amp;&amp;  fight_in_progress) {</p>
<p class="code">    fight_lost = true;</p>
<p class="code">    transition_timer = 0;</p>
<p class="code">}</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">&nbsp;</p>
<p class="RecipeHeading">//~~~~~~~~~~~~~~~~    obj_fight_controller - DRAW EVENT   ~~~~~~~~~~~~~~~~</p>
<p class="code"><strong><span style="color:#00B050; ">// Draw fight UI and results</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">// Note: Room background will show  through automatically</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">// Only draw clear if you don't  have a background set</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">&nbsp;</span></strong></p>
<p class="code"><strong><span style="color:#00B050; ">// Draw a simple ground line</span></strong></p>
<p class="code">draw_set_color(c_dkgray);</p>
<p class="code">draw_rectangle(0, room_height * 0.6, room_width, room_height *  0.62, false);</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Draw fight result messages</span></strong></p>
<p class="code">if (fight_won) {</p>
<p class="code">     draw_set_halign(fa_center);</p>
<p class="code">     draw_set_valign(fa_middle);</p>
<p class="code">     draw_set_color(c_yellow);</p>
<p class="code">    draw_text_transformed(room_width  / 2, room_height / 2, &quot;VICTORY!&quot;, 2, 2, 0);</p>
<p class="code">    </p>
<p class="code">     draw_set_color(c_white);</p>
<p class="code">    draw_text(room_width /  2, room_height / 2 + 50, &quot;Returning to dungeon...&quot;);</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code">if (fight_lost) {</p>
<p class="code">     draw_set_halign(fa_center);</p>
<p class="code">     draw_set_valign(fa_middle);</p>
<p class="code">    draw_set_color(c_red);</p>
<p class="code">     draw_text_transformed(room_width / 2, room_height / 2,  &quot;DEFEAT!&quot;, 2, 2, 0);</p>
<p class="code">    </p>
<p class="code">     draw_set_color(c_white);</p>
<p class="code">    draw_text(room_width /  2, room_height / 2 + 50, &quot;Retreating...&quot;);</p>
<p class="code">}</p>
<p class="code">&nbsp;</p>
<p class="code"><strong><span style="color:#00B050; ">//</span></strong> <strong><span style="color:#00B050; ">Reset draw settings</span></strong></p>
<p class="code">draw_set_halign(fa_left);</p>
<p class="code">draw_set_valign(fa_top);</p>
<p class="code">draw_set_color(c_white);</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><footer class="footer">~ by StarsInDust ~  &#169 2023 –
<script type="text/javascript" src ="../../../../../JavaScript/FooterYearlyDate.js">
</script></footer>


  <script type="text/javascript" src ="../../../../../JavaScript/responsiveImage.js">
</script>   
       
</p></article></body>
</html>